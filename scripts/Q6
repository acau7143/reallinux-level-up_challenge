#!/usr/bin/env bash

set -euo pipefail

# 1) 테스트용 CPU 100% 프로세스 생성
yes > /dev/null &

# 2) 프로세스가 정상 실행 중인지 pid 확인
pgrep yes

# 3) 현재 CPU 사용량 상위 프로세스 확인 (top) (실행 후 q로 종료)
top -o %CPU

# 4) 현재 CPU 사용량 상위 프로세스 확인 (ps)
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head

# 5) 프로세스 이름(yes)로 PID 찾아 안전 종료 (pidof + kill)
sudo kill $(pidof yes)

# 6) 프로세스 다시 생성 (yes)
yes > /dev/null &

# 7) 프로세스 이름(yes)로 PID 찾아 강제 종료 (pgrep + kill -9)
sudo kill -9 $(pgrep yes)

# 8) 시스템 전체 부하 상태 요약 (vmstat)
vmstat 1 5
