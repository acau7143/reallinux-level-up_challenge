#!/usr/bin/env bash

set -euo pipefail

# 1) 설치 
#sudo apt-get update -y
sudo apt-get install -y nginx curl

# 2) 서비스 기동 + 부팅등록 
sudo systemctl enable --now nginx

# 3) 상태 점검 
sudo systemctl status nginx --no-pager

# 4) 기본 페이지 호출
echo " == test: / =="
curl -sS -I  http://localhost || true

sudo cat /var/log/nginx/access.log

# 5) 존재하지 않는 경로로 의도적 404 발생
echo "== test: /test, /test1 =="
curl -sS -I  http://localhost/test
curl -sS -I  http://localhost/test1

# 6) 접근 로그 최근 20줄 확인
echo "== access.log (tail -20) =="
sudo tail -n 20  /var/log/nginx/access.log || true

# 7) 404인 요청의 URI만 추출
echo "== 404 URIs =="
sudo grep ' 404 ' /var/log/nginx/access.log | awk '{print $7}'
